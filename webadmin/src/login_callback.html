<html>
<head>
    <title> Cloudron OAuth Callback </title>

    <script src="3rdparty/js/angular.min.js"></script>

    <script>

    'use strict';

    var app = angular.module('Application', []);
    app.controller('MainController', ['$scope', '$http', function ($scope, $http) {
        var authCode = window.location.search.slice('?authCode='.length);

        if (!authCode) {
            console.error('No authCode found.');
            window.location.href = '/';
        }

        var data = {
            grant_type: 'authorization_code',
            code: authCode,
            redirect_uri: window.location.origin,
            client_id: 'cid-webadmin',
            client_secret: 'secret-webadmin'
        };

        $http.post('/api/v1/oauth/token?response_type=token&client_id=' + data.client_id, data)
        .success(function(data, status) {
            if (status !== 200) return console.error('Unable to exchange authCode for an access token.', status, data);

            // the actual app picks up the access token from localStorage
            localStorage.token = data.access_token;

            window.location.href = '/';
        })
        .error(function(data, status) {
            console.error('Unable to exchange code for an access token.', status, data);
        });
    }]);

    </script>

</head>

<body ng-app="Application" ng-controller="MainController">

</body>
</html>
